#!/usr/bin/env python3
"""
全面繁體中文修復工具 - Comprehensive Traditional Chinese & Hong Kong Cantonese Fixer
修復所有簡體字並轉換為地道香港粵語
"""

import os
import re
import glob

# 全面的簡體轉繁體+香港粵語對應表
COMPREHENSIVE_FIXES = {
    # 最重要的香港化修正
    "知道": "知",  # 最常見，香港人說"我知"不說"我知道"
    "我唔知道": "我唔知",
    "唔知道": "唔知",
    "你知道": "你知",
    "佢知道": "佢知", 
    "大家知道": "大家都知",
    
    # 其他常見香港化修正
    "怎样": "怎樣",
    "怎么": "怎麼",
    "这样": "這樣",
    "那样": "那樣",
    "能够": "能夠",
    "应该": "應該",
    "可能会": "可能會",
    "实际": "實際",
    "规则": "規則",
    "帮助": "幫助", 
    "帮到": "幫到",
    "获得": "獲得",
    "听说": "聽說",
    "说话": "講話",
    "讲话": "講話",
    
    # 動詞修正
    "来": "嚟",  # 香港粵語用"嚟"
    "过来": "過嚟",
    "回来": "返嚟",
    "出来": "出嚟",
    "起来": "起嚟",
    "看来": "睇嚟",
    "听起来": "聽起嚟",
    
    # 常見簡體字
    "会": "會",
    "对": "對",
    "说": "講",
    "讲": "講", 
    "给": "俾",  # 香港粵語用"俾"
    "给你": "俾你",
    "给我": "俾我", 
    "给他": "俾佢",
    "给她": "俾佢",
    "让": "讓",
    "让人": "讓人",
    "买": "買",
    "卖": "賣",
    "钱": "錢",
    "电话": "電話",
    "电脑": "電腦",
    "电": "電",
    "学": "學",
    "学习": "學習",
    "学校": "學校",
    "学生": "學生",
    "读": "讀",
    "读书": "讀書",
    "写": "寫",
    "听": "聽",
    "看": "睇",  # 香港粵語用"睇"
    "看见": "睇見",
    "看到": "睇到",
    "观": "觀",
    "发": "發",
    "发现": "發現",
    "发生": "發生",
    "发展": "發展",
    "关": "關",
    "关系": "關係",
    "关于": "關於",
    "问": "問",
    "问题": "問題",
    "答": "答",
    "爱": "愛",
    "爱情": "愛情",
    "欢": "歡",
    "欢迎": "歡迎",
    "乐": "樂",
    "快乐": "快樂",
    "难": "難",
    "难过": "難過",
    "变": "變",
    "变得": "變得",
    "变成": "變成",
    "开": "開",
    "开始": "開始",
    "开心": "開心",
    "关": "關",
    "过": "過",
    "过程": "過程",
    "经": "經",
    "经过": "經過",
    "时": "時",
    "时间": "時間",
    "时候": "時候",
    "没": "冇",  # 香港粵語用"冇"
    "没有": "冇",
    "没得": "冇得",
    "还": "仲",  # 香港粵語用"仲"
    "还是": "仲係",
    "还有": "仲有",
    "还要": "仲要",
    "还会": "仲會",
    "谢": "謝",
    "谢谢": "多謝",  # 香港人說"多謝"
    "对不起": "對唔住",  # 香港粵語
    "再见": "再見",
    "见": "見",
    "认": "認",
    "认识": "認識",
    "认为": "認為",
    "觉": "覺",
    "觉得": "覺得",
    "报": "報",
    "报告": "報告",
    "处": "處",
    "处理": "處理",
    "复": "複",
    "复杂": "複雜",
    "简": "簡",
    "简单": "簡單",
    "紧": "緊",
    "紧张": "緊張",
    "压": "壓",
    "压力": "壓力",
    "担": "擔",
    "担心": "擔心",
    "烦": "煩",
    "烦恼": "煩惱",
    "高": "高",
    "高兴": "高興",
    "赚": "搵",  # 香港粵語"搵錢"
    "赚钱": "搵錢",
    "挣钱": "搵錢",
    "工": "工",
    "朋": "朋",
    "朋友": "朋友",
    "老": "老",
    "老师": "老師",
    "师": "師",
    
    # 常見詞組修正
    "是的": "係嘅",
    "不是": "唔係", 
    "可以": "可以",
    "不可以": "唔可以",
    "要": "要",
    "不要": "唔要",
    "想": "想",
    "不想": "唔想",
    "喜欢": "鍾意",  # 香港粵語
    "不喜欢": "唔鍾意",
    "好的": "好嘅",
    "不好": "唔好",
    "有": "有",
    "没有": "冇",
    "是": "係",  # 香港粵語用"係"
    "不是": "唔係",
    "在": "喺",  # 香港粵語用"喺"
    "不在": "唔喺",
    "的": "嘅",  # 香港粵語用"嘅"
    "他": "佢",  # 香港粵語用"佢"
    "她": "佢",
    "它": "佢",
    "不": "唔",  # 香港粵語用"唔"
    "了": "咗",  # 香港粵語用"咗"
    "这": "呢",  # 香港粵語用"呢"
    "那": "嗰",  # 香港粵語用"嗰"
    "这个": "呢個",
    "那个": "嗰個",
    "什么": "咩",  # 香港粵語用"咩"
    "什么时候": "幾時",
    "怎么样": "點樣",
    "为什么": "點解",
    "哪里": "邊度",
    "哪个": "邊個",
    "怎么办": "點算",
    "这里": "呢度",
    "那里": "嗰度",
    "比较": "比較",
    "一点": "少少",  # 香港粵語
    "有点": "有啲",  # 香港粵語用"有啲"
    "很多": "好多",
    "太多": "太多",
    "一些": "啲",  # 香港粵語用"啲"
    "这些": "呢啲",
    "那些": "嗰啲",
    
    # 標點和語氣詞
    "吧": "啦",  # 香港粵語語氣詞
    "呢": "呢",
    "嘛": "嘛",
    "啊": "呀",
    "吗": "咩",  # 香港粵語疑問詞
    
    # 完整短語替換
    "晚安": "good night",  # 更香港化
    "早上好": "早晨",
    "下午好": "午安",
    "你好": "你好",
    "再见": "bye bye",  # 香港人常說bye bye
    "吃饭": "食飯",  # 香港粵語用"食"
    "吃了": "食咗",
    "喝水": "飲水",
    "睡觉": "瞓覺",  # 香港粵語用"瞓"
    "走路": "行路",
    "坐车": "搭車",  # 香港粵語用"搭"
    "上班": "返工",  # 香港粵語用"返工"
    "下班": "收工",
    "上学": "返學",
    "回家": "返屋企",
    "在家": "喺屋企",
}

def fix_text_comprehensive(text):
    """全面修復文字"""
    
    # 先處理完整詞組，再處理單字
    # 按長度降序排列，避免部分匹配覆蓋完整匹配
    sorted_fixes = sorted(COMPREHENSIVE_FIXES.items(), key=lambda x: len(x[0]), reverse=True)
    
    for old, new in sorted_fixes:
        text = text.replace(old, new)
    
    return text

def fix_file(file_path):
    """修復單個檔案"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        original_content = content
        fixed_content = fix_text_comprehensive(content)
        
        if fixed_content != original_content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(fixed_content)
            return True
        
        return False
        
    except Exception as e:
        print(f"❌ 處理檔案 {file_path} 時出錯：{e}")
        return False

def main():
    """主函數"""
    print("=== 🇭🇰 全面繁體中文+香港粵語修復工具 ===")
    print("正在修復所有簡體字並轉換為地道香港粵語...\n")
    
    # 要處理的檔案類型
    file_patterns = ['*.py', '*.txt', '*.md', '*.json']
    fixed_files = []
    
    for pattern in file_patterns:
        files = glob.glob(pattern, recursive=True)
        files.extend(glob.glob(f"**/{pattern}", recursive=True))
        
        for file_path in files:
            # 跳過特定檔案
            if any(skip in file_path for skip in ['__pycache__', '.git', 'fix_traditional', 'test_traditional']):
                continue
                
            if fix_file(file_path):
                fixed_files.append(file_path)
    
    print(f"✅ 已修復 {len(fixed_files)} 個檔案")
    
    if fixed_files:
        print("\n📝 修復的檔案：")
        for file_path in fixed_files[:10]:  # 只顯示前10個
            print(f"   • {file_path}")
        if len(fixed_files) > 10:
            print(f"   ... 還有 {len(fixed_files) - 10} 個檔案")
    
    print(f"\n🎉 修復完成！總共處理了 {len(fixed_files)} 個檔案")
    
    # 顯示主要修復項目
    print("\n=== 📋 主要修復項目 ===")
    key_fixes = [
        "知道 → 知 (香港粵語)",
        "来 → 嚟 (香港粵語)", 
        "给 → 俾 (香港粵語)",
        "看 → 睇 (香港粵語)",
        "没有 → 冇 (香港粵語)",
        "还 → 仲 (香港粵語)",
        "喜欢 → 鍾意 (香港粵語)",
        "谢谢 → 多謝 (香港粵語)",
        "对不起 → 對唔住 (香港粵語)",
        "简体字 → 繁體字"
    ]
    
    for fix in key_fixes:
        print(f"   ✅ {fix}")

if __name__ == "__main__":
    main() 